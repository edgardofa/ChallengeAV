@model IndexViewModel
@{

    ViewData["Title"] = "";
}

<div class="container">
    <div class="row border-bottom px-2">
        <div class="col-lg-12 ">
            <div class="row justify-content-lg-center">
                <h3 class="font-weight-bold">SERVICIO DEL CLIMA</h3>
            </div>
        </div>
    </div>

    <div class="row pt-2">
        <div class="col-lg-6 col-sm-12">
            <div class="card " style="height: 18.5rem;">
                <div class="card-body">
                    <h5 class="card-title text-lg-center text-md-center text-sm-left">Seleccioná la zona</h5>
                    <hr class="underline" />
                    <form method="post" asp-area="" asp-controller="Home" asp-action="ConsultarClima">
                        <div class="row">
                            @Html.Label("NombrePais", "País")
                        </div>
                        <div class="row">
                            <select class="form-control mw-100 w-100 border-select p-1" id="paisSelect" name="paisSelect" selected="selected">
                                @{
                                    if (Model.ListaPaises?.Count > 0)
                                    {
                                        <option value="NN"> -- Selecciona un país </option>
                                        foreach (SelectListItem pais in Model.ListaPaises)
                                        {
                                            <option value="@pais.Value">@pais.Text</option>
                                        }
                                    }
                                    else
                                    {
                                        <option value="NN"> -- Sin Datos </option>
                                    }
                                }
                            </select>
                        </div>
                        <br />
                        <div class="row">
                            @Html.Label("NombreCiudad", "Ciudad")
                        </div>

                        <div class="row">
                            <select name="ciudades" class="form-control mw-100 w-100 border-select top-10" id="ciudades" selected="selected">
                            </select><br />
                        </div>
                        <div class="text-center pt-lg-0">
                            <input class="btn btn-primary btn-block text-white" style="background-color:coral;margin-top:0.5rem; margin-bottom:0.25rem" 
                                   type="submit" asp-action="ConsultarClima" asp-controller="Home" asp-route-id="ciudades" value="Buscar" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-sm-12">
            @if (!string.IsNullOrEmpty(Model.Ident_CiudadSelect))
            {
                <div class="card" style="height: 18.5rem;">
                    <div class="card-body">
                        <h5 class="card-title text-lg-center text-md-center text-sm-left">Reporte del día</h5>
                        <hr class="underline" />
                        <div class="row">
                            <div class="col-lg-6">
                                <h6 class="card-text text-left .small"><small>@Model.DescripPais</small></h6>
                                <h6 class="card-text text-left"><small>@Model.DescripCiudad</small></h6>
                                @if (Model.ReporteDelDia != null)
                                {
                                    <h3 class="card-text text-left">@Model.ReporteDelDia.NombreDelDia</h3>
                                    <h5 class="card-text text-left">@Model.ReporteDelDia.DescripClima</h5>
                                    <div class="container">
                                        <div class="row">
                                            <h1 class="card-text align-self-center"><strong>@Model.ReporteDelDia.TemperaturaC.ToString()</strong> </h1>
                                            <h6 class="card-text align-self-start" style="margin-top:0.25rem" >°C</h6>
                                        </div>
                                    </div>                                    
                                    <small class="text-muted">@Model.ReporteDelDia.TemperaturaF °F</small>
                                }
                            </div>
                            <div class="col-lg-6">
                                @if (Model.ReporteDelDia != null)
                                {
                                    @if (!string.IsNullOrEmpty(Model.ReporteDelDia.UrlImagen))
                                    {
                                        <img class="img-rounded text-center" alt="@Model.ReporteDelDia.DescripClima" src="@Model.ReporteDelDia.UrlImagen" width="100" height="100" />
                                    }
                                    <h6 class="card-text text-left" style="margin-top:2rem;font-size:small;">
                                        Probabilidad de precipitaciones:  @Model.ReporteDelDia.Precipitaciones.ToString() %
                                    </h6>
                                    <h6 class="card-text text-left" style="font-size:small;">
                                        Humedad: @Model.ReporteDelDia.Humedad.ToString() %
                                    </h6>
                                    <h6 class="card-text text-left" style="font-size:small;">
                                        Vientos: a @Model.ReporteDelDia.Vientos.ToString() Km/h
                                    </h6>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="row" style="margin-top: 1rem;">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="container">
                        <div class="row justify-content-between">
                            @{
                                if (Model.ListaPronosticos?.Count() > 0)
                                {
                                    for (int a = 0; a < 5; a++)
                                    {
                                        <div class="col-sm-2 border-right">
                                            <h5 class="card-title" style="text-align:left">@Model.ListaPronosticos[a].NombreDelDia</h5>
                                            <img class="img-rounded" style="text-align:right" alt="@Model.ListaPronosticos[a].DescripClima" src=@Model.ListaPronosticos[a].UrlImagen width="80" height="80" />
                                            <h5 class="card-title" style="text-align: left; margin-top: 3rem;font-size:small;">@Model.ListaPronosticos[a].TemperaturaC.ToString() °C</h5>
                                            <small class="text-muted" style="text-align:left; margin-top: 1rem;">@Model.ListaPronosticos[a].TemperaturaF.ToString() °F</small>
                                        </div>
                                    }
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section scripts {

    <script type="text/javascript">


        $(document).ready(function () {
            $('#paisSelect').change(function () {
                fillCombo("ciudades", $('#paisSelect').val());
            });
        });
        //FUNCION PARA COMPLETAR CUIDADES SEGUN PAIS SELECCIONADO **************   
        function fillCombo(updateId, value) {
            var formData = {
                paisId: value
            };
            $.ajax({
                method: "POST",
                url: "/Home/CiudadPorPais",
                data: formData
            }).done(function (Data) {
                const respuesta = JSON.parse(Data);
                $("#" + updateId ).empty();
                $("#" + updateId).append("<option value='0' id='0'>" +' --- Seleccione una ciudad ---' +
                     "</option>");
                $.each(respuesta, function (i, item) {
                    $("#" + updateId).append("<option value='" + item.Id + "' id='"
                        + item.Id + "'>" + item.NombreCiudad
                        + "</option>");
                });
            }).fail(function (Data) {
                alert("No se pudo actualizar la lista de Ciudades");
            });
        }
    //*************************************************************************
        function Consultar() {
            var formData = {
                ciudadId: $('#ciudades').val()
            };
            $.ajax({
                method: "POST",
                url: "/Home/ConsultarClima",
                data: formData
            }).done(function (Data) {
                alert("Consulta Completada");
                });
        //    .fail(function (Data) {
        //        alert("No se pudo actualizar la lista de Ciudades");
        //    });
        }
    //*************************************************************************
    </script>

}